(function(n,t){if(t.breeze)n(t.breeze);else if(typeof require=="function"&&typeof exports=="object"&&typeof module=="object"){var i=require("vendor");n(i)}else if(typeof define=="function"&&define.amd&&!t.breeze)define(["vendor"],n);else throw new Error("Can't find vendor");})(function(n){"use strict";function o(t,i){t.addDataService(new n.DataService({serviceName:i}))}function s(t,i){this.patch(i);var r=i.isComplexType?new n.ComplexType(i):new n.EntityType(i);return t.addEntityType(r),this.inferValidators(r),this.addTypeNameAsResource(t,r),r}function h(n,t){t.isComplexType||n.setEntityTypeForResourceName(t.shortName,t)}function c(n,t,r){var f=r.validators;u(f)||(r.validators=f=[f]);f.forEach(function(r,u){if(!(r instanceof i))try{f[u]=i.fromJSON(r)}catch(e){throw"{0}.{1}.validators[{2}] = '{3}' can't be converted to a known Validator.".format(n,t,u,JSON.stringify(r));}})}function l(n){var u=n.dataProperties,f=n.shortName.toLowerCase()+"id",t,i,r;for(t in u){if(i=u[t],i.isPartOfKey)return t;if(i.isPartOfKey==null&&(r=t.toLowerCase(),r==="id"||r===f))return i.isPartOfKey=!0,t}return null}function a(n){n.defaultResourceName===undefined&&(n.defaultResourceName=this.pluralize(n.shortName))}function v(n){function t(n,t){if(t){var r=t.name,i=n.validators,u=i.filter(function(n){return n.name==r});u.length||i.push(t)}}function u(n){var t=n.dataType,i=!t||t===r.String?null:t.validatorCtor;return i?i():null}return n.dataProperties.forEach(function(n){n.isNullable||t(n,i.required());t(n,u(n));n.maxLength!=null&&n.dataType===r.String&&t(n,i.maxLength({maxLength:n.maxLength}))}),n}function y(n,t){switch(typeof t){case"string":return{entityTypeName:t};case"object":return t;default:var i=n.substr(0,1).toUpperCase()+n.substr(1);return{entityTypeName:i}}}function p(n){var r,i,o,c,s,h,e,l,a,f;n.name&&t(n,"name","shortName");o=n.shortName;c=n.namespace=n.namespace||this.defaultNamespace;n.isComplexType||(this.inferDefaultResourceName(n),this.findEntityKey(n),n.autoGeneratedKeyType=n.autoGeneratedKeyType||this.defaultAutoGeneratedKeyType);s=n.dataProperties;for(r in s)i=s[r],this.replaceDataPropertyAliases(i,r),i.complexTypeName&&i.complexTypeName.indexOf(":#")===-1&&(i.complexTypeName+=":#"+c),i.isPartOfKey&&(i.isNullable=i.isNullable===!0),i.validators&&this.convertValidators(o,r,i);h=n.navigationProperties;for(r in h){if(i=h[r]=y(r,h[r]),this.replaceNavPropertyAliases(i,r),e=i.entityTypeName,l=e.indexOf(":#"),l===-1?i.entityTypeName+=":#"+c:e=e.slice(0,l),i.foreignKeyNames===undefined&&i.isScalar!==!1&&i.invForeignKeyNames===undefined){var p=r.toLowerCase()+"id",w=e.toLowerCase()+"id",v=Object.keys(s).filter(function(n){return n=n.toLowerCase(),n===p||n===w})[0];v&&(i.foreignKeyNames=[v])}i.associationName===undefined&&(a=i.isScalar===!1||i.invForeignKeyNames||i.foreignKeyNames===undefined,i.associationName=(a?e:o)+"_"+(a?o:e));f=i.foreignKeyNames;f&&!u(f)&&(i.foreignKeyNames=[f]);f=i.invForeignKeyNames;f&&!u(f)&&(i.invForeignKeyNames=[f])}}function w(n){var t=n.length;switch(n[t-1]){case"s":return n+"es";case"x":return n+"es";case"y":return n.substr(0,t-1)+"ies";default:return n+"s"}}function t(n,t,i){if(n[i]!==undefined)throw"renameAttrib error; new name, '"+i+"' is already defined for the object.";n[i]=n[t];delete n[t]}function b(n){var i,u;for(i in n)e(n,i)&&(u=i.toLowerCase(),u==="type"?t(n,i,"dataType"):u==="complex"||u==="complextype"?t(n,i,"complexTypeName"):u==="max"&&(n.dataType===undefined||n.dataType===r.String)?t(n,i,"maxLength"):u.indexOf("null")>-1&&i!=="isNullable"&&typeof n[i]=="boolean"?t(n,i,"isNullable"):u==="required"?(n[i]=!n[i],t(n,i,"isNullable")):u.indexOf("key")>-1&&i!=="isPartOfKey"&&typeof n[i]=="boolean"?t(n,i,"isPartOfKey"):u==="default"?t(n,i,"defaultValue"):u==="isone"||u==="hasone"?t(n,i,"isScalar"):(u==="ismany"||u==="hasmany")&&(n[i]=!n[i],t(n,i,"isScalar")))}function k(n){var i,r;for(i in n)e(n,i)&&(r=i.toLowerCase(),r==="type"?t(n,i,"entityTypeName"):r==="fk"||r==="fks"||r==="key"?t(n,i,"foreignKeyNames"):r==="isone"||r==="hasone"?t(n,i,"isScalar"):r==="ismany"||r==="hasmany"?(n[i]=!n[i],t(n,i,"isScalar")):r==="invfk"||r==="invfks"?t(n,i,"invForeignKeyNames"):r.indexOf("assoc")>-1&&i!=="associationName"&&t(n,i,"associationName"))}function d(t){this.defaultAutoGeneratedKeyType=t||n.AutoGeneratedKeyType.None}function g(n){this.defaultNamespace=n||""}function e(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function u(n){return Object.prototype.toString.call(n)==="[object Array]"}var f=function(t,i){this.defaultNamespace=t||"";this.defaultAutoGeneratedKeyType=i||n.AutoGeneratedKeyType.None},r,i;f.prototype={constructor:f,addDataService:o,addTypeNameAsResource:h,addTypeToStore:s,convertValidators:c,findEntityKey:l,inferDefaultResourceName:a,inferValidators:v,patch:p,pluralize:w,replaceDataPropertyAliases:b,replaceNavPropertyAliases:k,setDefaultAutoGeneratedKeyType:d,setDefaultNamespace:g,_hasOwnProperty:e,_isArray:u};n.config.MetadataHelper=f;r=n.DataType;i=n.Validator},this);